
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>anemoi.io.database &#8212; anemoi 0.0.49 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for anemoi.io.database</h1><div class="highlight"><pre>
<span></span><span class="c1"># Import libraries</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">anemoi</span> <span class="k">as</span> <span class="nn">an</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pyodbc</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>

<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">urllib3</span>

<span class="k">def</span> <span class="nf">return_between_date_query_string</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">start_date</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end_date</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_end_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;AND [TimeStampLocal] &gt;= &#39;</span><span class="si">%s</span><span class="s1">&#39; AND [TimeStampLocal] &lt; &#39;</span><span class="si">%s</span><span class="s1">&#39; &#39;&#39;&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">start_date</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end_date</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_end_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;AND [TimeStampLocal] &gt;= &#39;</span><span class="si">%s</span><span class="s1">&#39; &#39;&#39;&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">start_date</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end_date</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_end_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;AND [TimeStampLocal] &lt; &#39;</span><span class="si">%s</span><span class="s1">&#39; &#39;&#39;&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">end_date</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_end_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
        <span class="k">return</span> <span class="n">start_end_str</span>
    
<span class="k">def</span> <span class="nf">sql_or_string_from_mvs_ids</span><span class="p">(</span><span class="n">mvs_ids</span><span class="p">):</span>
    <span class="n">or_string</span> <span class="o">=</span> <span class="s1">&#39; OR &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;mvs_id = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mvs_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">mvs_id</span> <span class="ow">in</span> <span class="n">mvs_ids</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">or_string</span>

<span class="k">def</span> <span class="nf">sql_list_from_mvs_ids</span><span class="p">(</span><span class="n">mvs_ids</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mvs_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">mvs_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">mvs_ids</span><span class="p">]</span>
    <span class="n">mvs_ids_list</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">f</span><span class="s2">&quot;(</span><span class="si">{mvs_id}</span><span class="s2">_1)&quot;</span> <span class="k">for</span> <span class="n">mvs_id</span> <span class="ow">in</span> <span class="n">mvs_ids</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">mvs_ids_list</span>

<span class="k">def</span> <span class="nf">rename_mvs_id_column</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">types</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])]</span>
    <span class="n">data_type</span> <span class="o">=</span> <span class="n">types</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{name}</span><span class="s1">_</span><span class="si">{data_type}</span><span class="s1">&#39;</span>

<span class="c1"># Define DataBase class</span>
<div class="viewcode-block" id="M2D2"><a class="viewcode-back" href="../../../code_io_database.html#anemoi.io.database.M2D2">[docs]</a><span class="k">class</span> <span class="nc">M2D2</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Class to connect to RAG M2D2 PRD database</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Data structure for connecting to and downloading data from M2D2. Convention is::</span>

<span class="sd">            import anemoi as an</span>
<span class="sd">            m2d2 = an.io.database.M2D2()</span>
<span class="sd">        </span>
<span class="sd">        :Parameters:</span>
<span class="sd">        </span>

<span class="sd">        :Returns:</span>

<span class="sd">        out: an.M2D2 object connected to M2D2</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="s1">&#39;M2D2&#39;</span>
        <span class="n">server</span> <span class="o">=</span> <span class="s1">&#39;10.1.15.53&#39;</span> <span class="c1"># PRD</span>
        <span class="c1">#server = &#39;SDHQRAGDBDEV01\RAGSQLDBSTG&#39; #STG</span>
        <span class="n">db</span> <span class="o">=</span> <span class="s1">&#39;M2D2_DB_BE&#39;</span>
        
        <span class="n">conn_str</span> <span class="o">=</span> <span class="s1">&#39;DRIVER={SQL Server}; SERVER=</span><span class="si">%s</span><span class="s1">; DATABASE=</span><span class="si">%s</span><span class="s1">; Trusted_Connection=yes&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn_str</span> <span class="o">=</span> <span class="n">conn_str</span> <span class="c1">#Assign connection string</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn_str</span><span class="p">)</span> <span class="c1">#Apply connection string to connect to database</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Database connection error: you either don</span><span class="se">\&#39;</span><span class="s1">t have permission to the database or aren</span><span class="se">\&#39;</span><span class="s1">t signed onto the VPN&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">connection_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">==</span> <span class="n">database</span>

<div class="viewcode-block" id="M2D2.masts"><a class="viewcode-back" href="../../../code_io_database.html#anemoi.io.database.M2D2.masts">[docs]</a>    <span class="k">def</span> <span class="nf">masts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :Returns:</span>

<span class="sd">        out: DataFrame of all met masts with measured data in M2D2</span>

<span class="sd">        Example::</span>

<span class="sd">            import anemoi as an</span>
<span class="sd">            m2d2 = an.io.database.M2D2()</span>
<span class="sd">            m2d2.masts()</span>

<span class="sd">        &#39;&#39;&#39;</span> 
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_check</span><span class="p">(</span><span class="s1">&#39;M2D2&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Need to connect to M2D2 to retrieve met masts. Use anemoi.DataBase(database=&quot;M2D2&quot;)&#39;</span><span class="p">)</span>
        
        <span class="n">sql_query_masts</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        SELECT [Project]</span>
<span class="s1">            ,[AssetID]</span>
<span class="s1">            ,[wmm_id]</span>
<span class="s1">            ,[mvs_id]</span>
<span class="s1">            ,[Name]</span>
<span class="s1">            ,[Type]</span>
<span class="s1">            ,[StartDate]</span>
<span class="s1">            ,[StopDate]</span>
<span class="s1">        FROM [M2D2_DB_BE].[dbo].[ViewProjectAssetSensors] WITH (NOLOCK)</span>
<span class="s1">        &#39;&#39;&#39;</span>
        
        <span class="n">sql_query_coordinates</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        SELECT [wmm_id]</span>
<span class="s1">            ,[WMM_Latitude]</span>
<span class="s1">            ,[WMM_Longitude]</span>
<span class="s1">            ,[WMM_Elevation]</span>
<span class="s1">        FROM [M2D2_DB_BE].[dbo].[ViewWindDataSet]&#39;&#39;&#39;</span>
        
        <span class="n">masts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql_query_masts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;StartDate&#39;</span><span class="p">,</span> <span class="s1">&#39;StopDate&#39;</span><span class="p">])</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql_query_coordinates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">masts</span> <span class="o">=</span> <span class="n">masts</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;wmm_id&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;wmm_id&#39;</span><span class="p">)</span>

        <span class="n">masts</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;Project&#39;</span><span class="p">,</span> <span class="s1">&#39;wmm_id&#39;</span><span class="p">,</span> <span class="s1">&#39;WMM_Latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;WMM_Longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;Type&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">masts</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">masts</span></div>
    
    <span class="k">def</span> <span class="nf">mvs_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">masts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">masts</span><span class="p">()</span>
        <span class="n">mvs_ids</span> <span class="o">=</span> <span class="n">masts</span><span class="o">.</span><span class="n">mvs_id</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">mvs_ids</span>

    <span class="k">def</span> <span class="nf">valid_signal_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">signal_type_query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        SELECT [MDVT_ID]</span>
<span class="s1">              ,[MDVT_Name]</span>
<span class="s1">        FROM [M2D2_DB_BE].[dbo].[MDataValueType]&#39;&#39;&#39;</span>

        <span class="n">signal_types</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">signal_type_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;MDVT_Name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">MDVT_ID</span>
        <span class="k">return</span> <span class="n">signal_types</span>

    <span class="k">def</span> <span class="nf">column_labels_for_masts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">masts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">masts</span><span class="p">()</span>
        <span class="n">mvs_ids</span> <span class="o">=</span> <span class="n">masts</span><span class="o">.</span><span class="n">mvs_id</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">or_string</span> <span class="o">=</span> <span class="s1">&#39; OR &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;mvs_id = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mvs_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">mvs_id</span> <span class="ow">in</span> <span class="n">mvs_ids</span><span class="p">])</span>
        
        <span class="n">column_label_sql_query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        SELECT [column_id]</span>
<span class="s1">            ,[label]</span>
<span class="s1">        FROM [M2D2_DB_BE].[dbo].[ViewWindogMetaData]</span>
<span class="s1">        WITH (NOLOCK)</span>
<span class="s1">        WHERE </span><span class="si">{}</span><span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">or_string</span><span class="p">)</span>

        <span class="n">column_labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">column_label_sql_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">column_labels</span> <span class="o">=</span> <span class="n">column_labels</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;column_id&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">column_labels</span>
    
    <span class="k">def</span> <span class="nf">column_labels_for_data_from_mvs_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">masts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">masts</span><span class="p">()</span>
        <span class="n">names_map</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">masts</span><span class="o">.</span><span class="n">mvs_id</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">masts</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        
        <span class="n">types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_signal_labels</span><span class="p">()</span>
        <span class="n">types</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;FLAG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Flag&#39;</span>
        <span class="n">types_map</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">types</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">types</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">rename_mvs_id_column</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names_map</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="n">types_map</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>        
        
    <span class="k">def</span> <span class="nf">column_labels_for_wmm_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wmm_id</span><span class="p">):</span>
        <span class="n">masts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">masts</span><span class="p">()</span>
        <span class="n">mvs_ids</span> <span class="o">=</span> <span class="n">masts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span><span class="p">[:,</span><span class="n">wmm_id</span><span class="p">],:]</span><span class="o">.</span><span class="n">mvs_id</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">or_string</span> <span class="o">=</span> <span class="s1">&#39; OR &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;mvs_id = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mvs_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">mvs_id</span> <span class="ow">in</span> <span class="n">mvs_ids</span><span class="p">])</span>
        
        <span class="n">column_label_sql_query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        SELECT [column_id]</span>
<span class="s1">            ,[label]</span>
<span class="s1">        FROM [M2D2_DB_BE].[dbo].[ViewWindogMetaData]</span>
<span class="s1">        WITH (NOLOCK)</span>
<span class="s1">        WHERE </span><span class="si">{}</span><span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">or_string</span><span class="p">)</span>

        <span class="n">column_labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">column_label_sql_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">column_labels</span> <span class="o">=</span> <span class="n">column_labels</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;column_id&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">column_labels</span>        
    
<div class="viewcode-block" id="M2D2.data_from_sensors_mvs_ids"><a class="viewcode-back" href="../../../code_io_database.html#anemoi.io.database.M2D2.data_from_sensors_mvs_ids">[docs]</a>    <span class="k">def</span> <span class="nf">data_from_sensors_mvs_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mvs_ids</span><span class="p">,</span> <span class="n">signal_type</span><span class="o">=</span><span class="s1">&#39;AVG&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Download sensor data from M2D2</span>
<span class="sd">        </span>
<span class="sd">        :Parameters:</span>
<span class="sd">        </span>
<span class="sd">        mvs_ids: int or list</span>
<span class="sd">            Virtual sensor IDs (mvs_ids) in M2D2, can be singular</span>
<span class="sd">        </span>
<span class="sd">        signal_type: str, default &#39;AVG&#39; - NOT SUPPORTED AT THIS TIME</span>
<span class="sd">            Signal type for download</span>
<span class="sd">            For example: &#39;AVG&#39;, &#39;SD&#39;, &#39;MIN&#39;, &#39;MAX&#39;, &#39;GUST&#39;</span>
<span class="sd">        </span>
<span class="sd">        :Returns:</span>
<span class="sd">        </span>
<span class="sd">        out: DataFrame with signal data from virtual sensor</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mvs_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">mvs_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">mvs_ids</span><span class="p">]</span>
        <span class="n">valid_mvs_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mvs_ids</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">mvs_id</span> <span class="ow">in</span> <span class="n">valid_mvs_ids</span> <span class="k">for</span> <span class="n">mvs_id</span> <span class="ow">in</span> <span class="n">mvs_ids</span><span class="p">]),</span> <span class="n">f</span><span class="s1">&#39;One of the following is not a valid mvs_id: </span><span class="si">{mvs_ids}</span><span class="s1">&#39;</span>
        
        <span class="n">mvs_ids_list</span> <span class="o">=</span> <span class="n">sql_list_from_mvs_ids</span><span class="p">(</span><span class="n">mvs_ids</span><span class="p">)</span>
        <span class="n">sql_query</span><span class="o">=</span> <span class="n">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">             SET NOCOUNT ON</span>
<span class="s2">             DECLARE @ColumnListID NVARCHAR(4000) </span>
<span class="s2">                   ,@startDate    DATETIME2      </span>
<span class="s2">                   ,@endDate      DATETIME2      </span>

<span class="s2">            SET @ColumnListID= &#39;</span><span class="si">{mvs_ids_list}</span><span class="s2">&#39;</span>
<span class="s2">            SET @startDate   = NULL</span>
<span class="s2">            SET @endDate     = NULL</span>

<span class="s2">            EXECUTE [dbo].[proc_DataExport_GetDataByColumnList]</span>
<span class="s2">                @ColumnListID             </span>
<span class="s2">                ,@startDate</span>
<span class="s2">                ,@endDate</span>
<span class="s2">            &quot;&quot;&quot;</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;CorrectedTimestamp&#39;</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;stamp&#39;</span>
        <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;sensor&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_labels_for_data_from_mvs_ids</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div>
        
<div class="viewcode-block" id="M2D2.data_from_mast_wmm_id"><a class="viewcode-back" href="../../../code_io_database.html#anemoi.io.database.M2D2.data_from_mast_wmm_id">[docs]</a>    <span class="k">def</span> <span class="nf">data_from_mast_wmm_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wmm_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Download data from all sensors on a mast from M2D2</span>
<span class="sd">        </span>
<span class="sd">        :Parameters:</span>
<span class="sd">        </span>
<span class="sd">        wmm_id: int</span>
<span class="sd">            Mast ID (wmm_id) in M2D2</span>
<span class="sd">        </span>
<span class="sd">        :Returns:</span>
<span class="sd">        </span>
<span class="sd">        out: DataFrame with signal data from each virtual sensor on the mast</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">masts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">masts</span><span class="p">()</span>
        <span class="n">wmm_ids</span> <span class="o">=</span> <span class="n">masts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;wmm_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">wmm_id</span> <span class="ow">in</span> <span class="n">wmm_ids</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;the following is not a valid wmm_id: </span><span class="si">{wmm_id}</span><span class="s1">&#39;</span>
        <span class="n">mvs_ids</span> <span class="o">=</span> <span class="n">masts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span><span class="p">[:,</span><span class="n">wmm_id</span><span class="p">],:]</span><span class="o">.</span><span class="n">mvs_id</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_from_sensors_mvs_ids</span><span class="p">(</span><span class="n">mvs_ids</span><span class="p">)</span>        
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="M2D2.metadata_from_mast_wmm_id"><a class="viewcode-back" href="../../../code_io_database.html#anemoi.io.database.M2D2.metadata_from_mast_wmm_id">[docs]</a>    <span class="k">def</span> <span class="nf">metadata_from_mast_wmm_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wmm_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Download mast metadata from M2D2</span>
<span class="sd">        </span>
<span class="sd">        :Parameters:</span>
<span class="sd">        </span>
<span class="sd">        wmm_id: int</span>
<span class="sd">            Mast ID (wmm_id) in M2D2</span>
<span class="sd">        </span>
<span class="sd">        :Returns:</span>
<span class="sd">        </span>
<span class="sd">        out: DataFrame with mast metadata</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">sql_query</span><span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        SELECT [WMM_Latitude]</span>
<span class="s1">            ,[WMM_Longitude]</span>
<span class="s1">            ,[WMM_Elevation]</span>
<span class="s1">        FROM [M2D2_DB_BE].[dbo].[ViewWindDataSet]</span>
<span class="s1">        WHERE wmm_id = </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">        &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wmm_id</span><span class="p">)</span>
        
        <span class="n">mast_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">mast_metadata</span> </div>

<div class="viewcode-block" id="M2D2.mast_from_wmm_id"><a class="viewcode-back" href="../../../code_io_database.html#anemoi.io.database.M2D2.mast_from_wmm_id">[docs]</a>    <span class="k">def</span> <span class="nf">mast_from_wmm_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wmm_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Download an.MetMast from M2D2</span>
<span class="sd">        </span>
<span class="sd">        :Parameters:</span>
<span class="sd">        </span>
<span class="sd">        wmm_id: int</span>
<span class="sd">            Mast ID (wmm_id) in M2D2</span>
<span class="sd">        </span>
<span class="sd">        :Returns:</span>
<span class="sd">        </span>
<span class="sd">        out: an.MetMast with data and metadata from M2D2</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Downloading Mast </span><span class="si">{wmm_id}</span><span class="s1"> from M2D2&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_from_mast_wmm_id</span><span class="p">(</span><span class="n">wmm_id</span><span class="o">=</span><span class="n">wmm_id</span><span class="p">)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_from_mast_wmm_id</span><span class="p">(</span><span class="n">wmm_id</span><span class="o">=</span><span class="n">wmm_id</span><span class="p">)</span>
        <span class="n">mast</span> <span class="o">=</span> <span class="n">an</span><span class="o">.</span><span class="n">MetMast</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> 
                         <span class="n">name</span><span class="o">=</span><span class="n">wmm_id</span><span class="p">,</span> 
                         <span class="n">lat</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">WMM_Latitude</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                         <span class="n">lon</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">WMM_Longitude</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                         <span class="n">elev</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">WMM_Elevation</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">mast</span></div>

<div class="viewcode-block" id="M2D2.masts_from_project"><a class="viewcode-back" href="../../../code_io_database.html#anemoi.io.database.M2D2.masts_from_project">[docs]</a>    <span class="k">def</span> <span class="nf">masts_from_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Download an.MetMasts from M2D2 for a given project</span>
<span class="sd">        </span>
<span class="sd">        :Parameters:</span>
<span class="sd">        </span>
<span class="sd">        project_name: str</span>
<span class="sd">            Project name in M2D2</span>
<span class="sd">        </span>
<span class="sd">        :Returns:</span>
<span class="sd">        </span>
<span class="sd">        out: List of an.MetMasts with data and metadata from M2D2 for a given project</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">masts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">masts</span><span class="p">()</span>
        <span class="n">projects</span> <span class="o">=</span> <span class="n">masts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Project&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">projects</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;Project </span><span class="si">{project}</span><span class="s1"> not found in M2D2&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>

        <span class="n">wmm_ids</span> <span class="o">=</span> <span class="n">masts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">project</span><span class="p">,:]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;wmm_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">masts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mast_from_wmm_id</span><span class="p">(</span><span class="n">wmm_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">wmm_id</span> <span class="ow">in</span> <span class="n">wmm_ids</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">masts</span></div></div>

<span class="c1"># Define Turbine class</span>
<div class="viewcode-block" id="Turbine"><a class="viewcode-back" href="../../../code_io_database.html#anemoi.io.database.Turbine">[docs]</a><span class="k">class</span> <span class="nc">Turbine</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Class to connect to EDF Wind Turbine database</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Data structure for connecting to and downloading data from M2D2. Convention is:</span>

<span class="sd">            import anemoi as an</span>
<span class="sd">            turb_db = an.io.database.Turbine()</span>
<span class="sd">        </span>
<span class="sd">        :Parameters:</span>
<span class="sd">        </span>

<span class="sd">        :Returns:</span>

<span class="sd">        out: an.Turbine object connected to Turbine database</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="s1">&#39;Turbine&#39;</span>
        <span class="n">server</span> <span class="o">=</span> <span class="s1">&#39;10.1.15.53&#39;</span>
        <span class="n">db</span> <span class="o">=</span> <span class="s1">&#39;Turbine_DB_BE&#39;</span>
        
        <span class="n">conn_str</span> <span class="o">=</span> <span class="s1">&#39;DRIVER={SQL Server}; SERVER=</span><span class="si">%s</span><span class="s1">; DATABASE=</span><span class="si">%s</span><span class="s1">; Trusted_Connection=yes&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn_str</span> <span class="o">=</span> <span class="n">conn_str</span> <span class="c1">#Assign connection string</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn_str</span><span class="p">)</span> <span class="c1">#Apply connection string to connect to database</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Database connection error: you either don</span><span class="se">\&#39;</span><span class="s1">t have permission to the database or aren</span><span class="se">\&#39;</span><span class="s1">t signed onto the VPN&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">==</span> <span class="n">database</span>

<div class="viewcode-block" id="Turbine.metadata"><a class="viewcode-back" href="../../../code_io_database.html#anemoi.io.database.Turbine.metadata">[docs]</a>    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get turbine model metadata&#39;&#39;&#39;</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="s1">&#39;Turbine&#39;</span><span class="p">),</span> <span class="s1">&#39;Trying to query the Turbine DB without being connected.&#39;</span>

        <span class="n">sql_query_turbines</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT [TUR_Manufacturer]</span>
<span class="s1">            ,[TUR_RatedOutputkW]</span>
<span class="s1">            ,[TPC_MaxOutput]</span>
<span class="s1">            ,[TUR_RotorDia]</span>
<span class="s1">            ,[TUR_Model]</span>
<span class="s1">            ,[AllHubHeights]</span>
<span class="s1">            ,[TPC_DocumentDate]</span>
<span class="s1">            ,[TUR_ID]</span>
<span class="s1">            ,[IECClass]</span>
<span class="s1">            ,[TPG_ID]</span>
<span class="s1">            ,[TPG_Name]</span>
<span class="s1">            ,[TPC_ID]</span>
<span class="s1">            ,[TVR_VersionName]</span>
<span class="s1">            ,[TPC_dbalevel]</span>
<span class="s1">            ,[TPC_TIScenario]</span>
<span class="s1">            ,[TPC_BinType]</span>
<span class="s1">            ,[TTC_ID]</span>
<span class="s1">            ,[TRPMC_ID]</span>
<span class="s1">            ,[P_ID]</span>
<span class="s1">            ,[P_Name]</span>
<span class="s1">            FROM [Turbine_DB_BE].[NodeEstimate].[AllPowerCurves]</span>
<span class="s1">            WHERE TPC_Type = &#39;Manufacturer General Spec&#39;</span>
<span class="s1">            &#39;&#39;&#39;</span>
        
        <span class="n">turbines</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql_query_turbines</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">turbines</span></div>

<div class="viewcode-block" id="Turbine.power_curve_from_tpc_id"><a class="viewcode-back" href="../../../code_io_database.html#anemoi.io.database.Turbine.power_curve_from_tpc_id">[docs]</a>    <span class="k">def</span> <span class="nf">power_curve_from_tpc_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tpc_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get turbine model metadata&#39;&#39;&#39;</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="s1">&#39;Turbine&#39;</span><span class="p">),</span> <span class="s1">&#39;Trying to query the Turbine DB without being connected.&#39;</span>

        <span class="n">sql_query_thrust_curve</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        SELECT TPCD_AirDensity, </span>
<span class="s1">            TPCD_WindSpeedBin, </span>
<span class="s1">            TPCD_OutputKW </span>
<span class="s1">        FROM TPCDETAILS </span>
<span class="s1">        WHERE TPC_id = </span><span class="si">{}</span><span class="s1"> AND TPCD_IsDeleted = 0;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tpc_id</span><span class="p">)</span>
        
        <span class="n">thrust_curve</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql_query_thrust_curve</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">thrust_curve</span></div>

<div class="viewcode-block" id="Turbine.trust_curve_from_ttc_id"><a class="viewcode-back" href="../../../code_io_database.html#anemoi.io.database.Turbine.trust_curve_from_ttc_id">[docs]</a>    <span class="k">def</span> <span class="nf">trust_curve_from_ttc_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttc_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get turbine model metadata&#39;&#39;&#39;</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="s1">&#39;Turbine&#39;</span><span class="p">),</span> <span class="s1">&#39;Trying to query the Turbine DB without being connected.&#39;</span>

        <span class="n">sql_query_thrust_curve</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        SELECT TTCD_AirDensity, </span>
<span class="s1">            TTCD_WindSpeedBin, </span>
<span class="s1">            TTCD_ThrustValue</span>
<span class="s1">        FROM TTCDETAILS </span>
<span class="s1">        WHERE TTC_id = </span><span class="si">{}</span><span class="s1"> AND TTCD_IsDeleted = 0;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ttc_id</span><span class="p">)</span>
        
        <span class="n">thrust_curve</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql_query_thrust_curve</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">thrust_curve</span></div></div>

<span class="c1"># Define Padre class</span>
<div class="viewcode-block" id="Padre"><a class="viewcode-back" href="../../../code_io_database.html#anemoi.io.database.Padre">[docs]</a><span class="k">class</span> <span class="nc">Padre</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Class to connect to PRE Padre database</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="s1">&#39;PADREScada&#39;</span><span class="p">,</span> <span class="n">conn_str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">domino</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Data structure with both database name and connection string.</span>
<span class="sd">        </span>
<span class="sd">        :Parameters:</span>

<span class="sd">        database: string, default None</span>
<span class="sd">          Name of the padre database to connect to</span>
<span class="sd">        </span>
<span class="sd">        conn_str: string, default None</span>
<span class="sd">          SQL connection string needed to connect to the database</span>
<span class="sd">        </span>
<span class="sd">        conn: object, default None</span>
<span class="sd">          SQL connection object to database</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">==</span> <span class="s1">&#39;PADREScada&#39;</span><span class="p">:</span>
            <span class="n">server</span> <span class="o">=</span> <span class="s1">&#39;10.1.106.44&#39;</span>
            <span class="n">db</span> <span class="o">=</span> <span class="s1">&#39;PADREScada&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">==</span> <span class="s1">&#39;PadrePI&#39;</span><span class="p">:</span>
            <span class="n">server</span> <span class="o">=</span> <span class="s1">&#39;10.1.106.44&#39;</span>
            <span class="n">db</span> <span class="o">=</span> <span class="s1">&#39;PADREScada&#39;</span>
        
        <span class="n">conn_str</span> <span class="o">=</span> <span class="s1">&#39;DRIVER={SQL Server}; SERVER=</span><span class="si">%s</span><span class="s1">; DATABASE=</span><span class="si">%s</span><span class="s1">; Trusted_Connection=yes&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn_str</span> <span class="o">=</span> <span class="n">conn_str</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn_str</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Database connection error: you either don</span><span class="se">\&#39;</span><span class="s1">t have permission to the database or aren</span><span class="se">\&#39;</span><span class="s1">t signed onto the VPN&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">==</span> <span class="n">database</span>

<div class="viewcode-block" id="Padre.assets"><a class="viewcode-back" href="../../../code_io_database.html#anemoi.io.database.Padre.assets">[docs]</a>    <span class="k">def</span> <span class="nf">assets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">turbines_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns:</span>
<span class="sd">        DataFrame of all turbines within Padre</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="s1">&#39;PADREScada&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Need to connect to Padre to retrieve turbines. Use anemoi.DataBase(database=&quot;Padre&quot;)&#39;</span><span class="p">)</span>
        
        <span class="n">sql_query_assets</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT [AssetKey]</span>
<span class="s1">              ,Projects.[ProjectName] </span>
<span class="s1">              ,[AssetType]</span>
<span class="s1">              ,[AssetName]</span>
<span class="s1">              ,Turbines.[Latitude]</span>
<span class="s1">              ,Turbines.[Longitude]</span>
<span class="s1">              ,[elevation_mt]</span>
<span class="s1">            FROM [PADREScada].[dbo].[Asset] as Turbines</span>
<span class="s1">            WITH (NOLOCK)</span>
<span class="s1">            INNER JOIN [PADREScada].[dbo].[Project] as Projects on Turbines.ProjectKey = Projects.ProjectKey</span>
<span class="s1">            &#39;&#39;&#39;</span>
        
        <span class="n">assets</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql_query_assets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        
        <span class="n">assets</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;ProjectName&#39;</span><span class="p">,</span> <span class="s1">&#39;AssetName&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">assets</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">turbines_only</span><span class="p">:</span>
            <span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">assets</span><span class="o">.</span><span class="n">AssetType</span> <span class="o">==</span> <span class="s1">&#39;Turbine&#39;</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">assets</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;AssetType&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">assets</span> <span class="o">=</span> <span class="n">assets</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">project</span><span class="p">,</span> <span class="p">:]</span>

        <span class="k">return</span> <span class="n">assets</span></div>

<div class="viewcode-block" id="Padre.operational_projects"><a class="viewcode-back" href="../../../code_io_database.html#anemoi.io.database.Padre.operational_projects">[docs]</a>    <span class="k">def</span> <span class="nf">operational_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns:</span>
<span class="sd">        List of all projects within Padre</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="s1">&#39;PADREScada&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Need to connect to Padre to retrieve projects. Use anemoi.DataBase(database=&quot;Padre&quot;)&#39;</span><span class="p">)</span>
        
        <span class="n">padre_project_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">          SELECT [ProjectKey]</span>
<span class="s2">            ,[ProjectName]</span>
<span class="s2">            ,[State]</span>
<span class="s2">            ,[NamePlateCapacity]</span>
<span class="s2">            ,[NumGenerators]</span>
<span class="s2">            ,[latitude]</span>
<span class="s2">            ,[longitude]</span>
<span class="s2">            ,[DateCOD]</span>
<span class="s2">          FROM [PADREScada].[dbo].[Project]</span>
<span class="s2">          WHERE technology = &#39;Wind&#39;&quot;&quot;&quot;</span>

        <span class="n">projects</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">padre_project_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">projects</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;ProjectName&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">projects</span></div>

    <span class="k">def</span> <span class="nf">turbine_categorizations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category_type</span><span class="o">=</span><span class="s1">&#39;EDF&#39;</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="s1">&#39;PADREScada&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Need to connect to Padre to retrieve turbines. Use anemoi.DataBase(database=&quot;Padre&quot;)&#39;</span><span class="p">)</span>
        
        <span class="n">padre_cetegory_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">          SELECT [CategoryKey]</span>
<span class="s2">                ,[StringName]</span>
<span class="s2">          FROM [PADREScada].[dbo].[Categories]</span>
<span class="s2">          WHERE CategoryType = &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;&quot;&quot;</span> <span class="o">%</span><span class="n">category_type</span>

        <span class="n">categories</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">padre_cetegory_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">categories</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;CategoryKey&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">categories</span>

    <span class="k">def</span> <span class="nf">QCd_turbine_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset_key</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="s1">&#39;PADREScada&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Need to connect to Padre to retrieve met masts. Use anemoi.DataBase(database=&quot;Padre&quot;)&#39;</span><span class="p">)</span>

        <span class="n">turbine_data_query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        SELECT [TimeStampLocal]</span>
<span class="s1">          ,[Average_Nacelle_Wdspd]</span>
<span class="s1">          ,[Average_Active_Power]</span>
<span class="s1">          ,[Average_Ambient_Temperature]</span>
<span class="s1">          ,[IEC Category]</span>
<span class="s1">          ,[EDF Category]</span>
<span class="s1">          ,[Expected Power (kW)]</span>
<span class="s1">          ,[Expected Energy (kWh)]</span>
<span class="s1">          ,[EnergyDelta (kWh)]</span>
<span class="s1">          ,[EnergyDelta (MWh)]</span>
<span class="s1">        FROM [PADREScada].[dbo].[vw_10mDataBI]</span>
<span class="s1">        WITH (NOLOCK)</span>
<span class="s1">        WHERE [assetkey] = </span><span class="si">%i</span><span class="s1">&#39;&#39;&#39;</span> <span class="o">%</span><span class="n">asset_key</span>

        <span class="n">turbine_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">turbine_data_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">turbine_data</span><span class="p">[</span><span class="s1">&#39;TimeStampLocal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">turbine_data</span><span class="p">[</span><span class="s1">&#39;TimeStampLocal&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
        <span class="n">turbine_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;TimeStampLocal&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">turbine_data</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">turbine_data</span> <span class="o">=</span> <span class="n">turbine_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">turbine_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">turbine_data</span>

    <span class="k">def</span> <span class="nf">raw_turbine_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset_key</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="s1">&#39;PADREScada&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Need to connect to Padre to retrieve met masts. Use anemoi.DataBase(database=&quot;Padre&quot;)&#39;</span><span class="p">)</span>

        <span class="n">turbine_data_query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        SELECT</span>
<span class="s1">          [TimeStampLocal]</span>
<span class="s1">          ,[Average_Nacelle_Wdspd]</span>
<span class="s1">          ,[Average_Active_Power]</span>
<span class="s1">          ,[Average_Nacelle_Direction]</span>
<span class="s1">          ,[Average_Blade_Pitch]</span>
<span class="s1">          ,[Minimum_Blade_Pitch]</span>
<span class="s1">          ,[Maximum_Blade_Pitch]</span>
<span class="s1">          ,[Average_Rotor_Speed]</span>
<span class="s1">          ,[Minimum_Rotor_Speed]</span>
<span class="s1">          ,[Maximum_Rotor_Speed]</span>
<span class="s1">          ,[Average_Ambient_Temperature]</span>
<span class="s1">          ,coalesce([IECStringKey_Manual]</span>
<span class="s1">                    ,[IECStringKey_FF]</span>
<span class="s1">                    ,[IECStringKey_Default]) IECKey</span>
<span class="s1">          ,coalesce([EDFStringKey_Manual]</span>
<span class="s1">                    ,[EDFStringKey_FF]</span>
<span class="s1">                    ,[EDFStringKey_Default]) EDFKey</span>
<span class="s1">          ,coalesce([State_and_Fault_Manual]</span>
<span class="s1">                    ,[State_and_Fault_FF]</span>
<span class="s1">                    ,[State_and_Fault]) State_and_Fault</span>
<span class="s1">        FROM [PADREScada].[dbo].[WTGCalcData10m]</span>
<span class="s1">        WITH (NOLOCK)</span>
<span class="s1">        WHERE [assetkey] = </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">asset_key</span><span class="p">,</span> <span class="n">return_between_date_query_string</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">))</span>

        <span class="n">turbine_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">turbine_data_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">turbine_data</span><span class="p">[</span><span class="s1">&#39;TimeStampLocal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">turbine_data</span><span class="p">[</span><span class="s1">&#39;TimeStampLocal&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
        <span class="n">turbine_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;TimeStampLocal&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">turbine_data</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">turbine_data</span> <span class="o">=</span> <span class="n">turbine_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">turbine_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">turbine_data</span>

    <span class="k">def</span> <span class="nf">raw_turbine_expected_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset_key</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="s1">&#39;PADREScada&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Need to connect to Padre to retrieve met masts. Use anemoi.DataBase(database=&quot;Padre&quot;)&#39;</span><span class="p">)</span>

        <span class="n">turbine_data_query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        SELECT</span>
<span class="s1">          [TimeStampLocal]</span>
<span class="s1">          ,[Expected_Power_NTF]</span>
<span class="s1">          ,[Expected_Energy_NTF]</span>
<span class="s1">          ,[Expected_Power_RefMet]</span>
<span class="s1">          ,[Expected_Energy_RefMet]</span>
<span class="s1">          ,[Expected_Power_Uncorr]</span>
<span class="s1">          ,[Expected_Energy_Uncorr]</span>
<span class="s1">          ,[Expected_Power_DensCorr]</span>
<span class="s1">          ,[Expected_Energy_DensCorr]</span>
<span class="s1">          ,[Expected_Power_AvgMet]</span>
<span class="s1">          ,[Expected_Energy_AvgMet]</span>
<span class="s1">          ,[Expected_Power_ProxyWTGs]</span>
<span class="s1">          ,[Expected_Energy_ProxyWTGs]</span>
<span class="s1">          ,[Expected_Power_MPC]</span>
<span class="s1">          ,[Expected_Energy_MPC]</span>
<span class="s1">        FROM [PADREScada].[dbo].[WTGCalcData10m]</span>
<span class="s1">        WITH (NOLOCK)</span>
<span class="s1">        WHERE [assetkey] = </span><span class="si">{}</span><span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">asset_key</span><span class="p">)</span>

        <span class="n">turbine_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">turbine_data_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">turbine_data</span><span class="p">[</span><span class="s1">&#39;TimeStampLocal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">turbine_data</span><span class="p">[</span><span class="s1">&#39;TimeStampLocal&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
        <span class="n">turbine_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;TimeStampLocal&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">turbine_data</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">turbine_data</span> <span class="o">=</span> <span class="n">turbine_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">turbine_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">turbine_data</span>

    <span class="k">def</span> <span class="nf">senvion_event_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="s1">&#39;PADREScada&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Need to connect to Padre to retrieve met masts. Use anemoi.DataBase(database=&quot;Padre&quot;)&#39;</span><span class="p">)</span>

        <span class="n">sql_query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        SELECT [assetkey]</span>
<span class="s1">              ,[TimeStamp]</span>
<span class="s1">              ,[statuscode]</span>
<span class="s1">              ,[incomingphasingoutreset]</span>
<span class="s1">        FROM [PADREScada].[dbo].[SenvionEventLog]</span>
<span class="s1">        WHERE projectkey = </span><span class="si">{}</span><span class="s1"> and incomingphasingoutreset != &#39;Reset&#39;</span>
<span class="s1">        ORDER BY assetkey, TimeStamp</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_id</span><span class="p">)</span>
        
        <span class="n">event_log</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">event_log</span>

    <span class="k">def</span> <span class="nf">ten_min_energy_by_status_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">padre_NTF</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="s1">&#39;PADREScada&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Need to connect to Padre to retrieve met masts. Use anemoi.DataBase(database=&quot;Padre&quot;)&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">padre_NTF</span><span class="p">:</span>
            <span class="n">padre_power_col</span> <span class="o">=</span> <span class="s1">&#39;Expected_Power_NTF&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">padre_power_col</span> <span class="o">=</span> <span class="s1">&#39;Expected_Power_DensCorr&#39;</span>

        <span class="n">padre_project_query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        SELECT [TimeStampLocal]</span>
<span class="s1">            ,[AssetKey]</span>
<span class="s1">            ,[Average_Active_Power]</span>
<span class="s1">            ,[</span><span class="si">{}</span><span class="s1">]</span>
<span class="s1">        FROM [PADREScada].[dbo].[WTGCalcData10m]</span>
<span class="s1">        WITH (NOLOCK)</span>
<span class="s1">        WHERE [projectkey] = </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">        ORDER BY TimeStampLocal, AssetKey&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">padre_power_col</span><span class="p">,</span> <span class="n">project_id</span><span class="p">,</span> <span class="n">return_between_date_query_string</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">))</span>
        
        <span class="n">data_ten_min</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">padre_project_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;TimeStampLocal&#39;</span><span class="p">,</span> <span class="s1">&#39;AssetKey&#39;</span><span class="p">])</span>
        <span class="n">data_ten_min</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;power_active&#39;</span><span class="p">,</span><span class="s1">&#39;power_expected&#39;</span><span class="p">]</span>
        <span class="n">data_ten_min</span> <span class="o">=</span> <span class="n">data_ten_min</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">data_ten_min</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="n">data_ten_min</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">data_ten_min</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">data_ten_min</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Stamp&#39;</span><span class="p">,</span> <span class="s1">&#39;AssetKey&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">data_ten_min</span>

    <span class="k">def</span> <span class="nf">senvion_ten_min_energy_by_status_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">,</span> <span class="n">status_codes</span><span class="o">=</span><span class="p">[</span><span class="mf">6680.0</span><span class="p">,</span> <span class="mf">6690.0</span><span class="p">,</span> <span class="mf">6697.0</span><span class="p">,</span> <span class="mf">15000.0</span><span class="p">]):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="s1">&#39;PADREScada&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Need to connect to Padre to retrieve met masts. Use anemoi.DataBase(database=&quot;Padre&quot;)&#39;</span><span class="p">)</span>
        
        <span class="n">projects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operational_projects</span><span class="p">()</span>
        <span class="n">project</span> <span class="o">=</span> <span class="n">projects</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">projects</span><span class="o">.</span><span class="n">ProjectKey</span> <span class="o">==</span> <span class="n">project_id</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">project</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Lac Alfred&#39;</span><span class="p">,</span><span class="s1">&#39;Massif du Sud&#39;</span><span class="p">,</span><span class="s1">&#39;St. Robert Bellarmin&#39;</span><span class="p">]:</span>
            <span class="n">padre_NTF</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">padre_NTF</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">event_log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">senvion_event_logs</span><span class="p">(</span><span class="n">project_id</span><span class="o">=</span><span class="n">project_id</span><span class="p">)</span>
        <span class="n">event_log_icing</span> <span class="o">=</span> <span class="n">event_log</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">event_log</span><span class="o">.</span><span class="n">statuscode</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">status_codes</span><span class="p">),</span> <span class="p">:]</span>
        <span class="n">incoming</span> <span class="o">=</span> <span class="n">event_log_icing</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">event_log_icing</span><span class="o">.</span><span class="n">incomingphasingoutreset</span> <span class="o">==</span> <span class="s1">&#39;incoming&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;assetkey&#39;</span><span class="p">,</span> <span class="s1">&#39;statuscode&#39;</span><span class="p">,</span> <span class="s1">&#39;TimeStamp&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">outgoing</span> <span class="o">=</span> <span class="n">event_log_icing</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">event_log_icing</span><span class="o">.</span><span class="n">incomingphasingoutreset</span> <span class="o">==</span> <span class="s1">&#39;phasing out&#39;</span><span class="p">,</span> <span class="s1">&#39;TimeStamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">incoming</span><span class="p">,</span> <span class="n">outgoing</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">status</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;asset_key&#39;</span><span class="p">,</span> <span class="s1">&#39;status_code&#39;</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">]</span>

        <span class="n">status</span><span class="p">[</span><span class="s1">&#39;start_ten_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">dt</span><span class="p">:</span> <span class="n">datetime</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span><span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">minute</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)))</span>
        <span class="n">status</span><span class="p">[</span><span class="s1">&#39;end_ten_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">end</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">dt</span><span class="p">:</span> <span class="n">datetime</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span><span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">minute</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)))</span>
        
        <span class="n">status_start_date</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;start_ten_min&#39;</span><span class="p">,</span><span class="s1">&#39;end_ten_min&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">status_end_date</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;start_ten_min&#39;</span><span class="p">,</span><span class="s1">&#39;end_ten_min&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">stamp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">status_start_date</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">status_end_date</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10T&#39;</span><span class="p">)</span>
        <span class="n">icing_flags_cols</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([</span><span class="n">status</span><span class="o">.</span><span class="n">asset_key</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">status_codes</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;AssetKey&#39;</span><span class="p">,</span> <span class="s1">&#39;Flag&#39;</span><span class="p">])</span>
        <span class="n">icing_flags</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">stamp</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">icing_flags_cols</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">icing_flags</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">asset_key</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">icing_flag</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">icing_flags</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">status</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">status</span><span class="o">.</span><span class="n">asset_key</span><span class="o">==</span><span class="n">asset_key</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">status_code</span><span class="o">==</span><span class="n">icing_flag</span><span class="p">),</span><span class="s1">&#39;start_ten_min&#39;</span><span class="p">],</span><span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span><span class="p">[</span><span class="n">asset_key</span><span class="p">,</span><span class="n">icing_flag</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">icing_flags</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">status</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">status</span><span class="o">.</span><span class="n">asset_key</span><span class="o">==</span><span class="n">asset_key</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">status_code</span><span class="o">==</span><span class="n">icing_flag</span><span class="p">),</span> <span class="s1">&#39;end_ten_min&#39;</span><span class="p">],</span><span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span><span class="p">[</span><span class="n">asset_key</span><span class="p">,</span><span class="n">icing_flag</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">icing_flags</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">icing_flags</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">icing_flags</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Stamp&#39;</span>
        
        <span class="n">data_power</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ten_min_energy_by_status_code</span><span class="p">(</span><span class="n">project_id</span><span class="o">=</span><span class="n">project_id</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">status_start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">status_end_date</span><span class="p">,</span> <span class="n">padre_NTF</span><span class="o">=</span><span class="n">padre_NTF</span><span class="p">)</span>
        <span class="n">data_power</span> <span class="o">=</span> <span class="n">data_power</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;Stamp&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;AssetKey&#39;</span><span class="p">)</span>
        <span class="n">data_power</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">data_power</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">()</span>
        <span class="n">data_ten_min</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data_power</span><span class="p">,</span> <span class="n">icing_flags</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data_ten_min</span>

    <span class="k">def</span> <span class="nf">monthly_energy_by_status_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">padre_NTF</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="s1">&#39;PADREScada&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Need to connect to Padre to retrieve met masts. Use anemoi.DataBase(database=&quot;Padre&quot;)&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">padre_NTF</span><span class="p">:</span>
            <span class="n">padre_power_col</span> <span class="o">=</span> <span class="s1">&#39;Expected_Power_NTF&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">padre_power_col</span> <span class="o">=</span> <span class="s1">&#39;Expected_Power_DensCorr&#39;</span>

        <span class="n">padre_project_query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        SELECT [TimeStampLocal]</span>
<span class="s1">            ,[AssetKey]</span>
<span class="s1">            ,[Average_Nacelle_Wdspd]</span>
<span class="s1">            ,[Average_Ambient_Temperature]</span>
<span class="s1">            ,[Average_Active_Power]</span>
<span class="s1">            ,[State_and_Fault] as Fault_Code</span>
<span class="s1">            ,[</span><span class="si">{}</span><span class="s1">]</span>
<span class="s1">        FROM [PADREScada].[dbo].[WTGCalcData10m]</span>
<span class="s1">        WITH (NOLOCK)</span>
<span class="s1">        WHERE [projectkey] = </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">        ORDER BY TimeStampLocal, AssetKey, Fault_Code&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">padre_power_col</span><span class="p">,</span> <span class="n">project_id</span><span class="p">,</span> <span class="n">return_between_date_query_string</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">))</span>
        
        <span class="n">columns_sum</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Average_Active_Power&#39;</span><span class="p">,</span><span class="s1">&#39;Expected_Power_NTF&#39;</span><span class="p">,</span><span class="s1">&#39;AssetKey&#39;</span><span class="p">,</span> <span class="s1">&#39;Fault_Code&#39;</span><span class="p">]</span>
        <span class="n">columns_count</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Average_Active_Power&#39;</span><span class="p">,</span> <span class="s1">&#39;AssetKey&#39;</span><span class="p">,</span> <span class="s1">&#39;Fault_Code&#39;</span><span class="p">]</span>
        <span class="n">monthly_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">padre_project_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;TimeStampLocal&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">)</span>
        <span class="n">monthly_data_sum</span> <span class="o">=</span> <span class="n">monthly_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">columns_sum</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">monthly_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">monthly_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="s1">&#39;AssetKey&#39;</span><span class="p">,</span> <span class="s1">&#39;Fault_Code&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">monthly_data_count</span> <span class="o">=</span> <span class="n">monthly_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">columns_count</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">monthly_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">monthly_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="s1">&#39;AssetKey&#39;</span><span class="p">,</span> <span class="s1">&#39;Fault_Code&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">monthly_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">monthly_data_sum</span><span class="p">,</span> <span class="n">monthly_data_count</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">6.0</span>
        <span class="n">monthly_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Average_Energy&#39;</span><span class="p">,</span><span class="s1">&#39;Expected_Energy_NTF&#39;</span><span class="p">,</span><span class="s1">&#39;Hours&#39;</span><span class="p">]</span>
        <span class="n">monthly_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;AssetKey&#39;</span><span class="p">,</span> <span class="s1">&#39;FaultCode&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">monthly_data</span>

    <span class="k">def</span> <span class="nf">site_production_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
        <span class="n">site_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">turbines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbines</span><span class="p">(</span><span class="n">project</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;AssetKey&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">turbine</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">turbines</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> of </span><span class="si">{}</span><span class="s1"> masts downloaded&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">turbines</span><span class="p">)))</span>
            <span class="n">turbine_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbine_data</span><span class="p">(</span><span class="n">turbine</span><span class="p">)</span>
            <span class="n">site_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">turbine_data</span><span class="p">)</span>

        <span class="n">site_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">site_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">turbines</span><span class="p">)</span>
        <span class="n">site_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Turbine&#39;</span><span class="p">,</span> <span class="s1">&#39;Signal&#39;</span><span class="p">]</span>
        <span class="n">site_data</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">site_data</span>

    <span class="k">def</span> <span class="nf">meter_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="s1">&#39;PadrePI&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Need to connect to PadrePI to retrieve met masts. Use anemoi.DataBase(database=&quot;PadrePI&quot;)&#39;</span><span class="p">)</span>

        <span class="n">meter_data_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT</span>
<span class="s2">        p.NamePlateCapacity/1000.0   AS NamePlateCapcity,</span>
<span class="s2">        p.NumGenerators,</span>
<span class="s2">        bopa.bop_asset_type          AS [BoPAssetType],</span>
<span class="s2">        bct.Time,</span>
<span class="s2">        bct.Average_Power,</span>
<span class="s2">        bct.Average_Reactive_Power,</span>
<span class="s2">        bct.Range_Produced_Energy,</span>
<span class="s2">        bct.Snapshot_Produced_Energy,</span>
<span class="s2">        bct.Range_Consumed_Energy,</span>
<span class="s2">        bct.Snapshot_Consumed_Energy </span>

<span class="s2">        FROM dbo.BoPCriticalTag bct</span>
<span class="s2">            INNER JOIN dbo.BoPAsset bopa ON bopa.bopassetkey = bct.BoPAssetKey</span>
<span class="s2">            INNER JOIN dbo.Project  p    ON p.ProjectKey   = bopa.projectkey</span>

<span class="s2">        WHERE bopa.BOP_Asset_Type LIKE &#39;%meter%&#39; and p.ProjectName = &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
        
        <span class="n">meter_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">meter_data_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">meter_data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">meter_data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
        <span class="n">meter_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">meter_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Stamp&#39;</span>
        <span class="n">meter_data</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">meter_data</span>

<div class="viewcode-block" id="Padre.operational_analysis_metadata"><a class="viewcode-back" href="../../../code_io_database.html#anemoi.io.database.Padre.operational_analysis_metadata">[docs]</a>    <span class="k">def</span> <span class="nf">operational_analysis_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns:</span>
<span class="sd">        Project metadata for operational analysis</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="s1">&#39;PADREScada&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Need to connect to Padre to retrieve projects. Use anemoi.DataBase(database=&quot;Padre&quot;)&#39;</span><span class="p">)</span>
        
        <span class="n">metadata_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT [ProjectName]</span>
<span class="s2">              ,[mfg]</span>
<span class="s2">              ,[TimeZone]</span>
<span class="s2">              ,[NamePlateCapacity]</span>
<span class="s2">              ,[NumGenerators]</span>
<span class="s2">              ,[latitude]</span>
<span class="s2">              ,[longitude]</span>
<span class="s2">              ,[DateCOD]</span>
<span class="s2">        FROM [PADREScada].[dbo].[Project] with(nolock)</span>
<span class="s2">        WHERE [PADREScada].[dbo].[Project].[technology] = &#39;Wind&#39; and </span>
<span class="s2">        [PADREScada].[dbo].[Project].[active] = 1</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">metadata_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">metadata</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;ProjectName&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">metadata</span></div>

<div class="viewcode-block" id="Padre.operational_analysis_monthly_invoiced_production"><a class="viewcode-back" href="../../../code_io_database.html#anemoi.io.database.Padre.operational_analysis_monthly_invoiced_production">[docs]</a>    <span class="k">def</span> <span class="nf">operational_analysis_monthly_invoiced_production</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns:</span>
<span class="sd">        Project monthly invoiced production for operational analysis</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="s1">&#39;PADREScada&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Need to connect to Padre to retrieve projects. Use anemoi.DataBase(database=&quot;Padre&quot;)&#39;</span><span class="p">)</span>
        
        <span class="n">invoiced_production_query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        SELECT P.[ProjectName]</span>
<span class="s1">              ,[Year]</span>
<span class="s1">              ,[Month]</span>
<span class="s1">              ,[InvoicedProduction_kWh]</span>
<span class="s1">        FROM [PADREScada].[dbo].[ProjectInvoicedProduction] PIP with(nolock)</span>
<span class="s1">        INNER JOIN [PADREScada].[dbo].[Project] P ON P.projectKey = PIP.ProjectKey</span>
<span class="s1">        &#39;&#39;&#39;</span>

        <span class="n">invoiced_production</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">invoiced_production_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">invoiced_production</span><span class="p">[</span><span class="s1">&#39;Day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">invoiced_production</span><span class="p">[</span><span class="s1">&#39;Stamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">invoiced_production</span><span class="p">[[</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span><span class="s1">&#39;Day&#39;</span><span class="p">]])</span>
        <span class="n">invoiced_production</span> <span class="o">=</span> <span class="n">invoiced_production</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;ProjectName&#39;</span><span class="p">,</span><span class="s1">&#39;Stamp&#39;</span><span class="p">])</span>
        <span class="n">invoiced_production</span> <span class="o">=</span> <span class="n">invoiced_production</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span><span class="s1">&#39;Day&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">invoiced_production</span></div>

<div class="viewcode-block" id="Padre.operational_analysis_scada_production"><a class="viewcode-back" href="../../../code_io_database.html#anemoi.io.database.Padre.operational_analysis_scada_production">[docs]</a>    <span class="k">def</span> <span class="nf">operational_analysis_scada_production</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns:</span>
<span class="sd">        Project monthly scada production for operational analysis</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">(</span><span class="s1">&#39;PADREScada&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Need to connect to Padre to retrieve projects. Use anemoi.DataBase(database=&quot;Padre&quot;)&#39;</span><span class="p">)</span>
        
        <span class="n">scada_production_query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        SELECT P.[ProjectName]</span>
<span class="s1">              ,[Date] Stamp</span>
<span class="s1">              ,[WTGProduction_MWh]</span>
<span class="s1">              ,[TotalExpectedProduction_MWh]</span>
<span class="s1">              ,[TotalEnergyDelta_MWh]</span>
<span class="s1">              ,[FullPerformanceEnergyDelta_MWH]</span>
<span class="s1">              ,[PartialPerformanceDegradedEnergyDelta_MWH]</span>
<span class="s1">              ,[PartialPerformanceDeratedEnergyDelta_MWH]</span>
<span class="s1">              ,[PartialPerformanceExtCurtailment_MWH]</span>
<span class="s1">              ,[PartialPerformanceEnvironmentEnergyDelta_MWH]</span>
<span class="s1">              ,[ForcedOutageEnergyDelta_MWH]</span>
<span class="s1">              ,[SchedMaintenanceEnergyDelta_MWH]</span>
<span class="s1">              ,[CorrectiveActionsEnergyDelta_MWH]</span>
<span class="s1">              ,[TechnicalStandbyEnergyDelta_MWH]</span>
<span class="s1">              ,[RequestedShutdownEnergyDelta_MWH]</span>
<span class="s1">              ,[RequestedShutdownExtCurtailmentEnergyDelta_MWH]</span>
<span class="s1">              ,[OutOfElectricalSpecEnergyDelta_MWH]</span>
<span class="s1">              ,[OutOfEnvironmentalSpecEnergyDelta_MWH]</span>
<span class="s1">              ,[CalmWindsEnergyDelta_MWH]</span>
<span class="s1">              ,[HighWindsEnergyDelta_MWH]</span>
<span class="s1">              ,[ForceMajeureEnergyDelta_MWH]</span>
<span class="s1">              ,[UnclassifiedDowntimeEnergyDelta_MWH]</span>
<span class="s1">        FROM [PADREScada].[dbo].[ProjectCalcDataDaily] PCDD with(nolock)</span>
<span class="s1">        INNER JOIN [PADREScada].[dbo].[Project] P ON P.projectKey = PCDD.ProjectKey</span>
<span class="s1">        &#39;&#39;&#39;</span>

        <span class="n">scada_production</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">scada_production_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Stamp&#39;</span><span class="p">])</span>
        <span class="n">scada_production</span> <span class="o">=</span> <span class="n">scada_production</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;ProjectName&#39;</span><span class="p">,</span><span class="s1">&#39;Stamp&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">scada_production</span></div></div>

<div class="viewcode-block" id="EIA"><a class="viewcode-back" href="../../../code_io_database.html#anemoi.io.database.EIA">[docs]</a><span class="k">class</span> <span class="nc">EIA</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Class to connect to EIA database via HTTP</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Data structure for connecting to and downloading data from EIA. Convention is::</span>

<span class="sd">            import anemoi as an</span>
<span class="sd">            eia = an.io.database.EIA()</span>
<span class="sd">        </span>
<span class="sd">        :Parameters:</span>
<span class="sd">        </span>

<span class="sd">        :Returns:</span>

<span class="sd">        out: an.EIA object connected to EIA.gov</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="s1">&#39;EIA&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="s1">&#39;9B2EDFF62577B236B5D66044ACECA2EF&#39;</span>

    <span class="k">def</span> <span class="nf">eia_data_from_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eia_id</span><span class="p">):</span>
        
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://api.eia.gov/series/?api_key=</span><span class="si">{}</span><span class="s1">&amp;series_id=ELEC.PLANT.GEN.</span><span class="si">{}</span><span class="s1">-WND-WT.M&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span> <span class="n">eia_id</span><span class="p">)</span>
        
        <span class="n">http</span> <span class="o">=</span> <span class="n">urllib3</span><span class="o">.</span><span class="n">PoolManager</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No EIA data for station: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eia_id</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">eia_id</span><span class="p">])</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))[</span><span class="s1">&#39;series&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Stamp&#39;</span><span class="p">,</span> <span class="n">eia_id</span><span class="p">])</span>
            <span class="n">data</span><span class="o">.</span><span class="n">Stamp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Stamp</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y%m&#39;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Stamp&#39;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">eia_id</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">eia_data_from_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eia_ids</span><span class="p">):</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">eia</span><span class="o">.</span><span class="n">eia_data</span><span class="p">(</span><span class="n">project</span><span class="p">)</span> <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">projects</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">eia_project_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/coryjog/wind_data/master/data/AWEA_database_metadata_multiple.parquet&#39;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">metadata</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
        <span class="n">metadata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;eia_id&#39;</span>
        <span class="k">return</span> <span class="n">metadata</span>

    <span class="k">def</span> <span class="nf">eia_turbine_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/coryjog/wind_data/master/data/AWEA_Turb_Report_20171207.parquet&#39;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">metadata</span>

    <span class="k">def</span> <span class="nf">project_centroids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eia_turbine_metadata</span><span class="p">()</span>
        <span class="n">centroids</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;Turbine Latitude&#39;</span><span class="p">,</span><span class="s1">&#39;Turbine Longitude&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">centroids</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">anemoi</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs_quick-start.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs_start-from-scratch.html">Start from Nothing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs_data_model.html">Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs_tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs_plotting.html">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_class_MetMast.html">Class - MetMast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_class_RefMast.html">Class - RefMast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_io_references.html">Input/Output - References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_io_database.html">Input/Output Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_analysis_shear.html">Analysis - Shear</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_analysis_correlate.html">Analysis - Correlate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_analysis_freq_dist.html">Analysis - Freq Dist</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_plotting_shear.html">Plotting - Shear</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_plotting_correlate.html">Plotting - Correlate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_analysis_sphinx_doc.html">Analysis – Sphinx doc page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_analysis_sphinx_doc2.html">Title for Sphinx Demo</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Cory Jog.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
    </div>

    

    
  </body>
</html>